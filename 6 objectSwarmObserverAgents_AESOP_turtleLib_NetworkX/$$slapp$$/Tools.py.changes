--- Tools.py	(original)
+++ Tools.py	(refactored)
@@ -29,10 +29,10 @@
   # about python 3 and im_class, see paragraph A.28 at
   # http://www.diveintopython3.net/porting-code-to-python-3-with-2to3.html
   name=""
-  c=m.im_class                      # class of m
+  c=m.__self__.__class__                      # class of m
   while name != 'object':
-   dk=c.__dict__.keys()             # keys   in the dict of c
-   dv=c.__dict__.values()           # values in the dict of c
+   dk=list(c.__dict__.keys())             # keys   in the dict of c
+   dv=list(c.__dict__.values())           # values in the dict of c
    f=m.__func__                     # the implicit func of m
    try:
         method=dk[dv.index(f)]      # the key of the value==f
@@ -60,7 +60,7 @@
 
   # we wrote the method as a str (preferred way from v.1.36)
   if not type(method) is str:
-    print method,"is neither an unbound method nor a string"
+    print(method,"is neither an unbound method nor a string")
     return False
   else:
     # method is an str
@@ -73,8 +73,8 @@
       exec("result=c."+method+"(instance,**k)")
       return result
     else:
-      print "Warning, class", c.__name__, "(or above) of agent", \
-             instance.agType, "does not have the method", method
+      print("Warning, class", c.__name__, "(or above) of agent", \
+             instance.agType, "does not have the method", method)
       return False
 
 
@@ -93,10 +93,10 @@
              try:
                 applyMethod(a,method,**k)
              except:
-              print 'cannot apply (case 0) method', method,\
-                    'to agent number', a.number, 'of type ',a.agType
+              print('cannot apply (case 0) method', method,\
+                    'to agent number', a.number, 'of type ',a.agType)
               # very special case
-              if a.agType=="recipes": print "first step", a.content[0]
+              if a.agType=="recipes": print("first step", a.content[0])
               pass
             # if we use k (a dictionary), the same notation has to
             # be placed into the agent methods
@@ -112,8 +112,8 @@
             else:
              try: applyMethod(a,method,**k)
              except:
-              print 'cannot apply (case 1) method', method,\
-                    'to agent number', a.number, 'of type ',a.agType
+              print('cannot apply (case 1) method', method,\
+                    'to agent number', a.number, 'of type ',a.agType)
               pass
             # if we use k (a dictionary), the same notation has to
             # be placed into the agent methods
@@ -129,8 +129,8 @@
     else:
      try: applyMethod(agent,method,**k)
      except:
-        print 'cannot apply (case 2) method', method, 'to agent number', \
-              a.number
+        print('cannot apply (case 2) method', method, 'to agent number', \
+              a.number)
         pass
 
 # applying a method to an instance of a class
@@ -142,8 +142,8 @@
     else:
      try: applyMethod(agent,method,**k)
      except:
-        print 'cannot apply (case 3) method', method, 'to agent number', \
-              a.number
+        print('cannot apply (case 3) method', method, 'to agent number', \
+              a.number)
         pass
 
     execLocalCode()
